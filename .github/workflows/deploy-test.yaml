name: Deploy Test

on:
  workflow_run:
    workflows:
      - Tag
    branches:
      - "v[0-9]+.[0-9]+-uat*"
    types:
      - completed

jobs:
  cd:
    name: cd
    runs-on: ctt-cd-test
    if: ${{ github.event.workflow_run.conclusion == 'success' }}

    steps:
    - name: Check out the repo
      uses: actions/checkout@v3
      with:
        ref: ${{ github.event.workflow_run.head_branch }}
        
    - name: Download artifacts - frontend
      uses: dawidd6/action-download-artifact@v2
      with:
        workflow: build.yml
        workflow_conclusion: success
        branch: master
        name: web
        path: downloads/web
    - name: Download artifacts - backend
      uses: dawidd6/action-download-artifact@v2
      with:
        workflow: build.yml
        workflow_conclusion: success
        branch: master
        name: api
        path: downloads/api
    - name: Display structure of downloaded files
      run: ls -R